{"version":3,"sources":["../src/mapdisplay.js"],"names":["define","$","ModalFactory","ModalEvents","initLeaflet","MAP","mapModalHidden","modal","off","remove","destroy","zeroBounds","bounds","ne","getNorthEast","sw","getSouthWest","lat","lng","toBounds","setView","getCenter","fitBounds","mapRenderGeojson","data","geojsonLayer","L","geoJSON","addTo","getBounds","addBasemap","tileLayer","attribution","mapModalShown","$geo","length","map","attr","JSON","parse","html","showMapModal","getRoot","on","hidden","shown","show","$target","console","error","geo","find","outerHTML","create","title","M","str","filter_geodata","mapviewer","body","large","type","types","ALERT","then"],"mappings":"AAAAA,OAAM,6BAAC,CACL,QADK,CAEL,oBAFK,CAGL,mBAHK,CAIL,4BAJK,CAAD,CAKH,SACDC,CADC,CAEDC,CAFC,CAGDC,CAHC,CAIDC,CAJC,CAKE,CAEH,GAAIC,CAAAA,CAAG,CAAG,IAAV,CAEAD,CAAW,GAJR,GAMGE,CAAAA,CAAc,CAAG,SAACC,CAAD,CAAW,CAChC,GAAIF,CAAJ,CAAS,CACPA,CAAG,CAACG,GAAJ,GACAH,CAAG,CAACI,MAAJ,EACD,CACDF,CAAK,CAACG,OAAN,EACD,CAZE,CAcGC,CAAU,CAAG,SAAAC,CAAM,CAAI,IACrBC,CAAAA,CAAE,CAAGD,CAAM,CAACE,YAAP,EADgB,CAErBC,CAAE,CAAGH,CAAM,CAACI,YAAP,EAFgB,CAG3B,MAAOH,CAAAA,CAAE,CAACI,GAAH,GAAWF,CAAE,CAACE,GAAd,EAAqBJ,CAAE,CAACK,GAAH,GAAWH,CAAE,CAACG,GAC3C,CAlBE,CAoBGC,CAAQ,CAAG,SAAAP,CAAM,CAAI,CACzB,GAAID,CAAU,CAACC,CAAD,CAAd,CAAwB,CACtBP,CAAG,CAACe,OAAJ,CAAYR,CAAM,CAACS,SAAP,EAAZ,CAAgC,EAAhC,CACD,CAFD,IAEO,CACLhB,CAAG,CAACiB,SAAJ,CAAcV,CAAd,CACD,CACF,CA1BE,CA4BGW,CAAgB,CAAG,SAAAC,CAAI,CAAI,CAC/B,GAAMC,CAAAA,CAAY,CAAGC,CAAC,CAACC,OAAF,CAAUH,CAAV,CAArB,CACAC,CAAY,CAACG,KAAb,CAAmBvB,CAAnB,EACAc,CAAQ,CAACM,CAAY,CAACI,SAAb,EAAD,CACT,CAhCE,CAkCGC,CAAU,CAAG,UAAM,CACvBJ,CAAC,CAACK,SAAF,CAAY,oDAAZ,CAAkE,CAChEC,WAAW,CAAE,2FADmD,CAAlE,EAEGJ,KAFH,CAESvB,CAFT,CAGD,CAtCE,CAwCG4B,CAAa,CAAG,UAAM,CAC1B,GAAMC,CAAAA,CAAI,CAAGjC,CAAC,CAAC,+BAAD,CAAd,CACA,GAAI,CAACiC,CAAI,CAACC,MAAV,CAAkB,CAChB,MACD,CAED9B,CAAG,CAAGqB,CAAC,CAACU,GAAF,CAAM,oBAAN,CAAN,CACAN,CAAU,GACV,GAA2B,SAAxB,GAAAI,CAAI,CAACG,IAAL,CAAU,QAAV,CAAH,CAAsC,CACpCd,CAAgB,CAACe,IAAI,CAACC,KAAL,CAAWL,CAAI,CAACM,IAAL,EAAX,CAAD,CACjB,CACF,CAnDE,CAqDGC,CAAY,CAAG,SAAAlC,CAAK,CAAI,CAC5BA,CAAK,CAACmC,OAAN,GAAgBC,EAAhB,CAAmBxC,CAAW,CAACyC,MAA/B,CAAuC,iBAAMtC,CAAAA,CAAc,CAACC,CAAD,CAApB,CAAvC,EACAA,CAAK,CAACmC,OAAN,GAAgBC,EAAhB,CAAmBxC,CAAW,CAAC0C,KAA/B,CAAsCZ,CAAtC,EACA1B,CAAK,CAACuC,IAAN,EACD,CAzDE,CA2DH,MAAO,UAAAC,CAAO,CAAI,CAChB,GAAI,CAACrB,CAAL,CAAQ,CACNsB,OAAO,CAACC,KAAR,CAAc,6BAAd,EACA,MACD,CAED,GAAMC,CAAAA,CAAG,CAAGH,CAAO,CAACI,IAAR,CAAa,SAAb,EAAwB,CAAxB,EAA2BC,SAAvC,CACAlD,CAAY,CAACmD,MAAb,CAAoB,CAClBC,KAAK,CAAEC,CAAC,CAACC,GAAF,CAAMC,cAAN,CAAqBC,SADV,CAElBC,IAAI,CAAE,2GAAuGT,CAAvG,CAA6G,QAFjG,CAGlBU,KAAK,GAHa,CAIlBC,IAAI,CAAE3D,CAAY,CAAC4D,KAAb,CAAmBC,KAJP,CAApB,EAKGC,IALH,CAKQvB,CALR,CAMD,CAEF,CApFK,CAAN","sourcesContent":["define([\n  'jquery',\n  'core/modal_factory',\n  'core/modal_events',\n  'filter_geodata/initleaflet'\n], (\n  $,\n  ModalFactory,\n  ModalEvents,\n  initLeaflet\n) => {\n\n  let MAP = null;\n\n  initLeaflet();\n\n  const mapModalHidden = (modal) => {\n    if (MAP) {\n      MAP.off();\n      MAP.remove();\n    }\n    modal.destroy();\n  };\n\n  const zeroBounds = bounds => {\n    const ne = bounds.getNorthEast();\n    const sw = bounds.getSouthWest();\n    return ne.lat === sw.lat && ne.lng === sw.lng;\n  };\n\n  const toBounds = bounds => {\n    if (zeroBounds(bounds)) {\n      MAP.setView(bounds.getCenter(), 15);\n    } else {\n      MAP.fitBounds(bounds);\n    }\n  };\n\n  const mapRenderGeojson = data => {\n    const geojsonLayer = L.geoJSON(data);\n    geojsonLayer.addTo(MAP);\n    toBounds(geojsonLayer.getBounds());\n  };\n\n  const addBasemap = () => {\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n    }).addTo(MAP);\n  };\n\n  const mapModalShown = () => {\n    const $geo = $('#filter-geodata-modal geodata');\n    if (!$geo.length) {\n      return;\n    }\n\n    MAP = L.map('filter-geodata-map');\n    addBasemap();\n    if($geo.attr('format') === 'geojson') {\n      mapRenderGeojson(JSON.parse($geo.html()));\n    }\n  };\n\n  const showMapModal = modal => {\n    modal.getRoot().on(ModalEvents.hidden, () => mapModalHidden(modal));\n    modal.getRoot().on(ModalEvents.shown, mapModalShown);\n    modal.show();\n  };\n\n  return $target => {\n    if (!L) {\n      console.error('Leaflet is not initialised!');\n      return;\n    }\n\n    const geo = $target.find('geodata')[0].outerHTML;\n    ModalFactory.create({\n      title: M.str.filter_geodata.mapviewer,\n      body: '<div id=\"filter-geodata-modal\"><div id=\"filter-geodata-map\" style=\"width:100%;height:60vh;\"></div>' + geo + '</div>',\n      large: true,\n      type: ModalFactory.types.ALERT\n    }).then(showMapModal);\n  };\n\n});\n"],"file":"mapdisplay.min.js"}