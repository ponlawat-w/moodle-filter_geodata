{"version":3,"sources":["../src/mapdisplay.js"],"names":["define","$","ModalFactory","ModalEvents","Leaflet","OsmBaseMap","MAP","mapModalHidden","modal","off","remove","destroy","zeroBounds","bounds","ne","getNorthEast","sw","getSouthWest","lat","lng","toBounds","setView","getCenter","fitBounds","mapRenderGeojson","data","geojsonLayer","geoJSON","addTo","getBounds","mapRenderPoint","points","split","map","x","parseFloat","trim","length","marker","getLatLng","mapModalShown","$geo","attr","JSON","parse","html","showMapModal","getRoot","on","hidden","shown","show","$target","console","error","geo","find","outerHTML","create","title","M","str","filter_geodata","mapviewer","body","large","type","types","ALERT","then"],"mappings":"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","sourcesContent":["define([\n  'jquery',\n  'core/modal_factory',\n  'core/modal_events',\n  'local_leaflet/core',\n  'local_leaflet/osmbasemap'\n], (\n  $,\n  ModalFactory,\n  ModalEvents,\n  Leaflet,\n  OsmBaseMap\n) => {\n\n  let MAP = null;\n\n  const mapModalHidden = (modal) => {\n    if (MAP) {\n      MAP.off();\n      MAP.remove();\n    }\n    modal.destroy();\n  };\n\n  const zeroBounds = bounds => {\n    const ne = bounds.getNorthEast();\n    const sw = bounds.getSouthWest();\n    return ne.lat === sw.lat && ne.lng === sw.lng;\n  };\n\n  const toBounds = bounds => {\n    if (zeroBounds(bounds)) {\n      MAP.setView(bounds.getCenter(), 15);\n    } else {\n      MAP.fitBounds(bounds);\n    }\n  };\n\n  const mapRenderGeojson = data => {\n    const geojsonLayer = Leaflet.geoJSON(data);\n    geojsonLayer.addTo(MAP);\n    toBounds(geojsonLayer.getBounds());\n  };\n\n  const mapRenderPoint = data => {\n    const points = data.split(',').map(x => parseFloat(x.trim()));\n    if (points.length > 1) {\n      const marker = Leaflet.marker({\n        lat: points[0],\n        lng: points[1]\n      }).addTo(MAP);\n      MAP.setView(marker.getLatLng(), 15);\n    }\n  };\n\n  const mapModalShown = () => {\n    const $geo = $('#filter-geodata-modal geodata');\n    if (!$geo.length) {\n      return;\n    }\n\n    MAP = Leaflet.map('filter-geodata-map');\n    OsmBaseMap.addTo(MAP);\n    if ($geo.attr('format') === 'geojson') {\n      mapRenderGeojson(JSON.parse($geo.html()));\n    } else if ($geo.attr('format') === 'point') {\n      mapRenderPoint($geo.html());\n    }\n  };\n\n  const showMapModal = modal => {\n    modal.getRoot().on(ModalEvents.hidden, () => mapModalHidden(modal));\n    modal.getRoot().on(ModalEvents.shown, mapModalShown);\n    modal.show();\n  };\n\n  return $target => {\n    if (!typeof Leaflet === 'undefined') {\n      console.error('Leaflet is not initialised!');\n      return;\n    }\n\n    const geo = $target.find('geodata')[0].outerHTML;\n    ModalFactory.create({\n      title: M.str.filter_geodata.mapviewer,\n      body: '<div id=\"filter-geodata-modal\"><div id=\"filter-geodata-map\" style=\"width:100%;height:60vh;\"></div>' + geo + '</div>',\n      large: true,\n      type: ModalFactory.types.ALERT\n    }).then(showMapModal);\n  };\n\n});\n"],"file":"mapdisplay.min.js"}